<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='schedule.css') }}">
    <title>Employee Availability</title>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>{{ name }}'s Availability</h1>
        </div>
    </header>

    <main>
        <section class="schedule-section">
            <div class="schedule-header">
                <h2>My Schedule</h2>
                <h3>My Availability | Events</h3>
            </div>

            <div class="toolbar">
                <div class="tags">
                    <a class="button" href="schedule">Schedule</a>
                    <button class="button" onclick="openModal()">Add +</button>
                </div>
                <div class="options">
                    <button class="button" onclick="submitAllAvailability()">Submit All Availability</button>
                    <button class="button" >Clear</button>
                    <button class="button" >Notify Manager</button>
                </div>
            </div>

            <div class="schedule-grid">
                <div class="empty-cell"></div>
                {% for hour in range(7, 18) %}
                    <div class="time-label"> {{ hour }}{{ 'AM' if hour < 12 else 'PM'}}</div>
                {% endfor %}

                {% for day in ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"] %}
                    <div class="day-label">{{ day }}</div>
                    {% for hour in range(7, 18) %}
                        <div class="cell"></div>
                    {% endfor %}
                {% endfor %}
            </div>
        </section>



        <div id="availabilityModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span>
                <h2>Add Availability</h2>
                <label for="day-select">Day:</label>
                <select id="day-select">
                    <option value="Monday">Monday</option>
                    <option value="Tuesday">Tuesday</option>
                    <option value="Wednesday">Wednesday</option>
                    <option value="Thursday">Thursday</option>
                    <option value="Friday">Friday</option>
                    <option value="Saturday">Saturday</option>
                    <option value="Sunday">Sunday</option>
                </select>

                <label for="start-time">Start Time:</label>
                <input type="time" id="start-time">

                <label for="end-time">End Time:</label>
                <input type="time" id="end-time">

                <button onclick="addAvailability()">Add Availability</button>
            </div>
        </div>

        <div id="availabilityList" class="availability-list"></div>
    </main>
    <script>
        let availabilitySlots = [];

        function openModal() {
            document.getElementById("availabilityModal").style.display = "block";
        }

        function closeModal() {
            document.getElementById("availabilityModal").style.display = "none";
        }
    
        document.addEventListener("DOMContentLoaded", () => {
            loadAvailability();
        });


    
        function loadAvailability() {
            fetch('/get_availability/1')  // Replace `1` with the actual employee ID
                .then(response => response.json())
                .then(data => {
                    availabilitySlots = data.availability;
    
                    // Display each availability slot
                    const list = document.getElementById("availabilityList");
                    list.innerHTML = "";  // Clear previous entries
                    availabilitySlots.forEach(slot => {
                        const listItem = document.createElement("div");
                        listItem.className = "availability-item";
                        listItem.textContent = `${slot.day}: ${slot.startTime} - ${slot.endTime}`;
                        list.appendChild(listItem);
                    });
                })
                .catch(error => console.error("Error loading availability:", error));
        }
    
        function addAvailability() {
            const day = document.getElementById("day-select").value;
            const startTime = document.getElementById("start-time").value;
            const endTime = document.getElementById("end-time").value;
    
            if (startTime && endTime) {
                const slot = { day, startTime, endTime };
                availabilitySlots.push(slot);
    
                const list = document.getElementById("availabilityList");
                const listItem = document.createElement("div");
                listItem.className = "availability-item";
                listItem.textContent = `${day}: ${startTime} - ${endTime}`;
                list.appendChild(listItem);
    
                closeModal();
            } else {
                alert("Please select both start and end times.");
            }
        }
    
        function submitAllAvailability() {
            fetch('/unavailability', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ slots: availabilitySlots })
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      alert("Availability submitted successfully!");
                      loadAvailability();  // Reload availability from the server
                      availabilitySlots = [];
                      document.getElementById("availabilityList").innerHTML = "";
                  } else {
                      alert("Failed to submit availability.");
                  }
              });
        }
    </script>    
</body>
</html>
